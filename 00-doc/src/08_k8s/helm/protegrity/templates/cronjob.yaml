{{- if .Values.cronjob.enabled }}
  apiVersion: batch/v1
   kind: CronJob
   metadata:
   name: {{ include "data-processor.fullname" . }}-{{ .Values.cronjob.name }}
  labels:
    {{- include "data-processor.labels" . | nindent 4 }}
      spec:
          schedule: "{{ .Values.cronjob.schedule }}"
            concurrencyPolicy: {{ .Values.cronjob.concurrencyPolicy }}
            startingDeadlineSeconds: {{ .Values.cronjob.startingDeadlineSeconds }}
            successfulJobsHistoryLimit: {{ .Values.cronjob.successfulJobsHistoryLimit }}
            failedJobsHistoryLimit: {{ .Values.cronjob.failedJobsHistoryLimit }}
            jobTemplate:
                spec:
                  template:
                  spec:
                  containers:
                  - name: data-writer
                  image: "{{ .Values.cronjob.image.repository }}:{{ .Values.cronjob.image.tag }}"
                  imagePullPolicy: {{ .Values.cronjob.image.pullPolicy }}
                  command: ["/bin/sh", "/scripts/data-writer.sh"]
                  volumeMounts:
                      - name: data-storage
                        mountPath: {{ .Values.persistence.mountPath }}
                      - name: scripts-volume
                        mountPath: /scripts
                  env:
                  - name: DATA_DIR
                  value: "{{ .Values.persistence.mountPath }}"
                  resources:
              {{- toYaml .Values.cronjob.resources | nindent 14 }}
                  volumes:
                      - name: data-storage
                        persistentVolumeClaim:
                        claimName: {{ include "data-processor.fullname" . }}-pvc
                      - name: scripts-volume
                        configMap:
                        name: {{ include "data-processor.fullname" . }}-scripts
                        defaultMode: 0755
                  restartPolicy: OnFailure
                {{- end }}